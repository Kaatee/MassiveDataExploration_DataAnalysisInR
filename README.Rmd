---
title: "Eksploracja Masywnych Danych - projekt 1 - Analiza danych"
author: "Katarzyna Jóźwiak 127237, Piotr Pawlaczyk 127245"
output:
  html_document: 
   toc: true
   theme: united
---
data wygenerowania: '`r format(Sys.Date(), "%Y-%B-%d")`'

# Podsumowanie badań
//TODO podsumowanie calego raportu

# Wykorzystane biblioteki
//TODO Kod wyliczający wykorzystane biblioteki.
library(datasets)
library(corrplot)

# Zapewnienie powtarzalności wyników przy każdym uruchomieniu raportu na tych samych danych
```{r}
set.seed(23)
```

# Wstęp
W podanym sprawozdaniu użyto zbioru danych sledzie.csv pobranego ze strony http://www.cs.put.poznan.pl/alabijak/emd/projekt/sledzie.csv . 
Zbiór ten opisuje rozmiary śledzi i warunki, w których żyją od 60-ciu lat. Kolejne kolumny w zbiorze danych to:  
* **length**: długość złowionego śledzia [cm];  
* **cfin1**: dostępność planktonu [zagęszczenie Calanus finmarchicus gat. 1];  
* **cfin2**: dostępność planktonu [zagęszczenie Calanus finmarchicus gat. 2];  
* **chel1**: dostępność planktonu [zagęszczenie Calanus helgolandicus gat. 1];  
* **chel2**: dostępność planktonu [zagęszczenie Calanus helgolandicus gat. 2];  
* **lcop1**: dostępność planktonu [zagęszczenie widłonogów gat. 1];  
* **lcop2**: dostępność planktonu [zagęszczenie widłonogów gat. 2];  
* **fbar**: natężenie połowów w regionie [ułamek pozostawionego narybku];  
* **recr**: roczny narybek [liczba śledzi];  
* **cumf**: łączne roczne natężenie połowów w regionie [ułamek pozostawionego narybku];  
* **totaln**: łączna liczba ryb złowionych w ramach połowu [liczba śledzi];  
* **sst**: temperatura przy powierzchni wody [°C];  
* **sal**: poziom zasolenia wody [Knudsen ppt];  
* **xmonth**: miesiąc połowu [numer miesiąca];  
* **nao**: oscylacja północnoatlantycka [mb].  
Wiersze w zbiorze są uporządkowane chronologicznie.

# Wczytywanie danych z pliku
```{r}
names <- read.table("sledzie.csv", nrow=1, stringsAsFactors = FALSE, sep = ",")
data <- read.table("sledzie.csv", header=TRUE,, stringsAsFactors = FALSE, sep=",")
head(data)

sapply(data, class)
```

Zmiana "?" na "NA" wraz ze zmianą typu danych z character na numeric:
```{r}
data[data=="?"] <- NA

data$cfin1 <- as.numeric(data$cfin1)
data$cfin2 <- as.numeric(data$cfin2)
data$chel1 <- as.numeric(data$chel1)
data$chel2 <- as.numeric(data$chel2)
data$lcop1 <- as.numeric(data$lcop1)
data$lcop2 <- as.numeric(data$lcop2)
data$sst <- as.numeric(data$sst)

head(data)
sapply(data, class)

```

# Rozmiar zbioru i statystyki
Sekcja podsumowująca rozmiar zbioru i podstawowe statystyki.
```{r}
paste("Wczytane dane zawierają ", nrow(data), " rekordów oraz ", ncol(data), " kolumn.", sep=" ")
```

Podsumowanie wartości danych:
```{r}
summary(data)
```

Ilość brakujących danych dla poszczególnych kolumn:
```{r}
missingData <- sapply(data, function(x) sum(is.na(x)))
missingData
class(missingData)
```
Wykres ilości brakujących danych w zbiorze:

```{r}
knitr::opts_chunk$set(fig.width=12, fig.height=8) 
plot(x = factor(names(missingData)), y = missingData, main="Wykres ilości brakujących danych w zbiorze", xlab="atrybut", ylab = "ilość brakujących artybutów")
```


# Brakujące dane
//TODO Kod przetwarzający brakujące dane.

# Szczegółowa analiza zbiorów wartości
//TODO Szczegółowa analiza wartości atrybutów (np. poprzez prezentację rozkładów wartości).


# Korelacja między zmiennymi
//TODO Sekcja sprawdzająca korelacje między zmiennymi; sekcja ta powinna zawierać jakąś formę graficznej prezentacji korelacji.
```{r cache=TRUE}
plot(data[,c(1:4)])
plot(data[,c(5:8)])
plot(data[,c(9:12)])
plot(data[,c(13:16)])
```

```{r}
res <- cor(na.omit(data)) #TODO - ogarnac brakujace wartosci w danych 
round(res, 2)

library(corrplot)
corrplot(res, type = "upper", tl.col = "black", tl.srt = 45)
```

//TODO opis tych tabelek

# Zmiana rozmiaru śledzia w czasie
//Interaktywny wykres lub animacja prezentująca zmianę rozmiaru śledzi w czasie.
```{r}
library(ggplot2)
library(gganimate)
library(dplyr)
#gifski package

p <- ggplot(
  na.omit(data), #ogarnąć brakujące dane
  aes(X, length, group = xmonth, color = factor(xmonth))
  ) +
  geom_line() +
  scale_color_viridis_d() +
  labs(x = "Kolejne połowy", y = "Dlugosc sledzia") +
  theme(legend.position = "top")
```

```{r}
p + geom_point() + transition_reveal(X)
```
//TODO - pobawic sie w pogrupowanie tych miesiecy w pory roku zeby nie bylo tak brzydko na wykresie

# Przewidywanie rozmiaru śledzia
//TODO Sekcję próbującą stworzyć regresor przewidujący rozmiar śledzia (w tej sekcji należy wykorzystać wiedzę z pozostałych punktów oraz wykonać dodatkowe czynności, które mogą poprawić trafność predykcji); dobór parametrów modelu oraz oszacowanie jego skuteczności powinny zostać wykonane za pomocą techniki podziału zbioru na dane uczące, walidujące i testowe; trafność regresji powinna zostać oszacowana na podstawie miar R2 i RMSE.

# Analiza ważnośći atrybutów najlepszego znalezionego modelu regresji
//TODO Analiza ważności atrybutów najlepszego znalezionego modelu regresji. Analiza ważności atrybutów powinna stanowić próbę odpowiedzi na pytanie: co sprawia, że rozmiar śledzi zaczął w pewnym momencie maleć.
