---
title: "Eksploracja Masywnych Danych - projekt 1 - Analiza danych"
author: "Katarzyna Jóźwiak 127237, Piotr Pawlaczyk 127245"
output:
  md_document: 
   toc: true
   #theme: united
---
data wygenerowania: '`r format(Sys.Date(), "%Y-%B-%d")`'

# Podsumowanie badań
***[TODO]*** podsumowanie calego raportu

# Wykorzystane biblioteki
Do analizy danych i stworzenia raportu z tej analizy zostały wykorzystane następujące biblioteki: 
- datasets    
- corrplot  
- ggplot2  
- gganimate  
- dplyr  
- gridExtra

# Zapewnienie powtarzalności wyników przy każdym uruchomieniu raportu na tych samych danych
Aby zapewnić powtarzalność próbkowań i losowań liczb przy każdym odpaleniu programu ustawiono stałe ziarno.  
***[TODO]*** Ogarnąć na końcu czy tego potrzebujemy
```{r}
set.seed(23)
```

# Wstęp
W podanym sprawozdaniu użyto zbioru danych sledzie.csv pobranego ze strony http://www.cs.put.poznan.pl/alabijak/emd/projekt/sledzie.csv . 
Zbiór ten opisuje rozmiary śledzi i warunki, w których żyją od 60-ciu lat. Kolejne kolumny w zbiorze danych to:  
* **length**: długość złowionego śledzia [cm];  
* **cfin1**: dostępność planktonu [zagęszczenie Calanus finmarchicus gat. 1];  
* **cfin2**: dostępność planktonu [zagęszczenie Calanus finmarchicus gat. 2];  
* **chel1**: dostępność planktonu [zagęszczenie Calanus helgolandicus gat. 1];  
* **chel2**: dostępność planktonu [zagęszczenie Calanus helgolandicus gat. 2];  
* **lcop1**: dostępność planktonu [zagęszczenie widłonogów gat. 1];  
* **lcop2**: dostępność planktonu [zagęszczenie widłonogów gat. 2];  
* **fbar**: natężenie połowów w regionie [ułamek pozostawionego narybku];  
* **recr**: roczny narybek [liczba śledzi];  
* **cumf**: łączne roczne natężenie połowów w regionie [ułamek pozostawionego narybku];  
* **totaln**: łączna liczba ryb złowionych w ramach połowu [liczba śledzi];  
* **sst**: temperatura przy powierzchni wody [°C];  
* **sal**: poziom zasolenia wody [Knudsen ppt];  
* **xmonth**: miesiąc połowu [numer miesiąca];  
* **nao**: oscylacja północnoatlantycka [mb].  
Wiersze w zbiorze są uporządkowane chronologicznie.

# Wczytywanie danych z pliku
```{r}
names <- read.table("sledzie.csv", nrow=1, stringsAsFactors = FALSE, sep = ",")
data <- read.table("sledzie.csv", header=TRUE, stringsAsFactors = FALSE, sep=",")
head(data)
```
Jak widać, wczytane dane zawierają znak "?" przy nieznanych danych.

Wyświetlenie klas poszczególnych kolumn:
```{r}
sapply(data, class)
```
Dane zawierające znak "?" zostały zinterpretowane jako tekst.
Zmiana "?" na "NA" wraz ze zmianą typu danych z character na numeric:
```{r}
data[data=="?"] <- NA
```
Po zmianie znaku "?" na wartość NA zmianiono typ danych kolumn z nieznanymi wartościami na wartości numeryczne.  
```{r}
data$cfin1 <- as.numeric(data$cfin1)
data$cfin2 <- as.numeric(data$cfin2)
data$chel1 <- as.numeric(data$chel1)
data$chel2 <- as.numeric(data$chel2)
data$lcop1 <- as.numeric(data$lcop1)
data$lcop2 <- as.numeric(data$lcop2)
data$sst <- as.numeric(data$sst)

head(data)
sapply(data, class)

```
***[TODO]*** może to jakoś ładniej zrobić "as.numeric" a nie tak brzydko powtarzając kod

# Rozmiar zbioru danych i podstawowe statystyki
```{r}
paste("Wczytane dane zawierają ", nrow(data), " rekordów oraz ", ncol(data), " kolumn.", sep=" ")
```

Podsumowanie wartości danych:
```{r}
summary(data)
```

Ilość brakujących danych dla poszczególnych kolumn:
```{r}
missingData <- sapply(data, function(x) sum(is.na(x)))
missingData
class(missingData)
```
Wykres ilości brakujących danych w zbiorze:

```{r}
plot(x = factor(names(missingData)), y = missingData, main="Wykres ilości brakujących danych w zbiorze", xlab="atrybut", ylab = "ilość brakujących artybutów")
```
Jak widać zbiór danych zawiera znaczną ilość brakujących danych, co może utrudnić ich późniejszą analizę.

# Brakujące dane
***[TODO]*** Kod przetwarzający brakujące dane.

# Szczegółowa analiza zbiorów wartości
***[TODO]*** Szczegółowa analiza wartości atrybutów (np. poprzez prezentację rozkładów wartości).
Poniżej przedstawiono rozkłady wszystkich wartośi w zbiorze danych     
***[TODO]*** Ogarnąć brakujące wartości - chyba że na.omit(data) jest ok?  
***[TODO]*** Ogarnąć żeby łądnie były osie podpisane a nie tak brzydko na sienie nachodziły  
```{r}
library(ggplot2)
library(ggExtra)

lengthDissPlot <- ggplot(na.omit(data), aes(x=length)) + geom_histogram(binwidth=.5, colour="black", fill="white")
cfin1DissPlot <- ggplot(na.omit(data), aes(x=cfin1)) + geom_histogram(binwidth=1, colour="black", fill="white",stat="count")
cfin2DissPlot <- ggplot(na.omit(data), aes(x=cfin2)) + geom_histogram(binwidth=1, colour="black", fill="white",stat="count")
chel1DissPlot <- ggplot(na.omit(data), aes(x=chel1)) + geom_histogram(binwidth=.5, colour="black", fill="white",stat="count")
chel2DissPlot <- ggplot(na.omit(data), aes(x=chel2)) + geom_histogram(binwidth=.5, colour="black", fill="white",stat="count")
lcop1DissPlot <- ggplot(na.omit(data), aes(x=lcop1)) + geom_histogram(binwidth=.5, colour="black", fill="white",stat="count")
lcop2DissPlot <- ggplot(na.omit(data), aes(x=lcop2)) + geom_histogram(binwidth=.5, colour="black", fill="white",stat="count")
fbarDissPlot <- ggplot(na.omit(data), aes(x=fbar)) + geom_histogram(binwidth=.05, colour="black", fill="white")
recrDissPlot <- ggplot(na.omit(data), aes(x=recr)) + geom_histogram(binwidth=50000.0, colour="black", fill="white")
cumfDissPlot <- ggplot(na.omit(data), aes(x=cumf)) + geom_histogram(binwidth=.02, colour="black", fill="white")
totalnDissPlot <- ggplot(na.omit(data), aes(x=totaln)) + geom_histogram(binwidth=1000.0, colour="black", fill="white")
sstDissPlot <- ggplot(na.omit(data), aes(x=sst)) + geom_histogram(binwidth=1.0, colour="black", fill="white",stat="count")
salDissPlot <- ggplot(na.omit(data), aes(x=sal)) + geom_histogram(binwidth=.01, colour="black", fill="white")
xmonthDissPlot <- ggplot(na.omit(data), aes(x=xmonth)) + geom_histogram(binwidth=1.0, colour="black", fill="white")
naoDissPlot <- ggplot(na.omit(data), aes(x=nao)) + geom_histogram(binwidth=.5, colour="black", fill="white")


require(gridExtra)
grid.arrange(lengthDissPlot,cfin1DissPlot,cfin2DissPlot ,chel1DissPlot ,chel2DissPlot,lcop1DissPlot,lcop2DissPlot ,fbarDissPlot ,
recrDissPlot ,cumfDissPlot ,totalnDissPlot ,sstDissPlot ,salDissPlot ,xmonthDissPlot ,naoDissPlot, nrow = 5, ncol=3)
```

# Korelacja między zmiennymi
//TODO Sekcja sprawdzająca korelacje między zmiennymi; sekcja ta powinna zawierać jakąś formę graficznej prezentacji korelacji.
```{r cache=TRUE}
plot(data[,c(1:4)])
plot(data[,c(5:8)])
plot(data[,c(9:12)])
plot(data[,c(13:16)])
```

```{r}
res <- cor(na.omit(data)) #TODO - ogarnac brakujace wartosci w danych 
round(res, 2)

library(corrplot)
corrplot(res, type = "upper", tl.col = "black", tl.srt = 45)
```

//TODO opis tych tabelek

# Zmiana rozmiaru śledzia w czasie
//Interaktywny wykres lub animacja prezentująca zmianę rozmiaru śledzi w czasie.
```{r}
library(ggplot2)
library(gganimate)
library(dplyr)
#gifski package

p <- ggplot(
  na.omit(data), #ogarnąć brakujące dane
  aes(X, length, group = xmonth, color = factor(xmonth))
  ) +
  geom_line() +
  scale_color_viridis_d() +
  labs(x = "Kolejne połowy", y = "Dlugosc sledzia") +
  theme(legend.position = "top")
```

```{r}
p + geom_point() + transition_reveal(X)
```
//TODO - ogarnac kwestie brakujacych danych
//TODO - pobawic sie w pogrupowanie tych miesiecy w pory roku zeby nie bylo tak brzydko na wykresie

# Przewidywanie rozmiaru śledzia
//TODO Sekcję próbującą stworzyć regresor przewidujący rozmiar śledzia (w tej sekcji należy wykorzystać wiedzę z pozostałych punktów oraz wykonać dodatkowe czynności, które mogą poprawić trafność predykcji); dobór parametrów modelu oraz oszacowanie jego skuteczności powinny zostać wykonane za pomocą techniki podziału zbioru na dane uczące, walidujące i testowe; trafność regresji powinna zostać oszacowana na podstawie miar R2 i RMSE.

# Analiza ważnośći atrybutów najlepszego znalezionego modelu regresji
//TODO Analiza ważności atrybutów najlepszego znalezionego modelu regresji. Analiza ważności atrybutów powinna stanowić próbę odpowiedzi na pytanie: co sprawia, że rozmiar śledzi zaczął w pewnym momencie maleć.
